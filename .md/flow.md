# User Flow Documentation

ì´ ë¬¸ì„œëŠ” Connecto ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì£¼ìš” ì‚¬ìš©ì í”Œë¡œìš°ë¥¼ ìƒì„¸íˆ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [ì‹ ê·œ ì‚¬ìš©ì ì˜¨ë³´ë”© í”Œë¡œìš°](#1-ì‹ ê·œ-ì‚¬ìš©ì-ì˜¨ë³´ë”©-í”Œë¡œìš°)
2. [ê¸°ì¡´ ì‚¬ìš©ì ë¡œê·¸ì¸ í”Œë¡œìš°](#2-ê¸°ì¡´-ì‚¬ìš©ì-ë¡œê·¸ì¸-í”Œë¡œìš°)
3. [Travel ìƒì„± ë° ì°¸ì—¬ í”Œë¡œìš°](#3-travel-ìƒì„±-ë°-ì°¸ì—¬-í”Œë¡œìš°)
4. [ì±„íŒ… í”Œë¡œìš°](#4-ì±„íŒ…-í”Œë¡œìš°)
5. [íŒŒì¼ ê³µìœ  í”Œë¡œìš°](#5-íŒŒì¼-ê³µìœ -í”Œë¡œìš°)
6. [ì•Œë¦¼ ê´€ë¦¬ í”Œë¡œìš°](#6-ì•Œë¦¼-ê´€ë¦¬-í”Œë¡œìš°)
7. [í”„ë¡œí•„ ê´€ë¦¬ í”Œë¡œìš°](#7-í”„ë¡œí•„-ê´€ë¦¬-í”Œë¡œìš°)
8. [ì‚¬ìš©ì ì°¨ë‹¨/ì‹ ê³  í”Œë¡œìš°](#8-ì‚¬ìš©ì-ì°¨ë‹¨ì‹ ê³ -í”Œë¡œìš°)

---

## 1. ì‹ ê·œ ì‚¬ìš©ì ì˜¨ë³´ë”© í”Œë¡œìš°

### 1.1 ì†Œì…œ ë¡œê·¸ì¸ì„ í†µí•œ íšŒì›ê°€ì…

```mermaid
graph TD
    A[ì•± ì‹œì‘] --> B[ë¡œê·¸ì¸ í™”ë©´]
    B --> C{ë¡œê·¸ì¸ ë°©ë²• ì„ íƒ}
    C -->|Google| D[Google OAuth ì¸ì¦]
    C -->|Apple| E[Apple OAuth ì¸ì¦]

    D --> F[ì†Œì…œ í† í° ê²€ì¦]
    E --> F

    F --> G{ê¸°ì¡´ ì‚¬ìš©ì?}
    G -->|No| H[ìƒˆ User ì—”í‹°í‹° ìƒì„±]
    G -->|Yes| M[ê¸°ì¡´ User ì •ë³´ ì¡°íšŒ]

    H --> I[Profile ìë™ ìƒì„±]
    I --> J[JWT í† í° ë°œê¸‰]

    M --> N{ê³„ì • ìƒíƒœ í™•ì¸}
    N -->|ì •ìƒ| J
    N -->|ì°¨ë‹¨ë¨| O[ë¡œê·¸ì¸ ê±°ë¶€]

    J --> K[í‘¸ì‹œ í† í° ë“±ë¡]
    K --> L[í™ˆ í™”ë©´ ì´ë™]
```

### 1.2 ìƒì„¸ ë‹¨ê³„

#### Step 1: ì†Œì…œ ë¡œê·¸ì¸ ì‹œì‘

```
POST /api/v1/auth/sign/social
{
  "provider": "google",
  "token": "social_auth_token",
  "pushToken": "fcm_token",
  "platform": "ios",
  "deviceId": "device_uuid"
}
```

#### Step 2: ì‚¬ìš©ì ìƒì„± í”„ë¡œì„¸ìŠ¤

1. **ì†Œì…œ ì¸ì¦ í† í° ê²€ì¦**
   - Google/Apple ì„œë²„ì™€ í†µì‹ í•˜ì—¬ í† í° ìœ íš¨ì„± í™•ì¸
   - ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ (socialId, email, name)

2. **User ì—”í‹°í‹° ìƒì„±**
   - socialIdì™€ providerë¡œ ì¤‘ë³µ í™•ì¸
   - ìƒˆ ì‚¬ìš©ìì¸ ê²½ìš° User ë ˆì½”ë“œ ìƒì„±
   - role: USER (ê¸°ë³¸ê°’)
   - notificationsEnabled: true (ê¸°ë³¸ê°’)

3. **Profile ìë™ ìƒì„±**
   - userId ì—°ê²°
   - ê¸°ë³¸ê°’ìœ¼ë¡œ ë¹ˆ í”„ë¡œí•„ ìƒì„±
   - ë‚˜ì¤‘ì— ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥

#### Step 3: í† í° ë°œê¸‰ ë° ì €ì¥

```json
Response:
{
  "accessToken": "jwt_access_token",
  "refreshToken": "jwt_refresh_token",
  "isNewUser": true,
  "pushTokenRegistered": true
}
```

---

## 2. ê¸°ì¡´ ì‚¬ìš©ì ë¡œê·¸ì¸ í”Œë¡œìš°

### 2.1 ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸

```mermaid
graph TD
    A[ì•± ì‹œì‘] --> B[ì €ì¥ëœ í† í° í™•ì¸]
    B --> C{Refresh Token ì¡´ì¬?}

    C -->|Yes| D[í† í° ê°±ì‹  ì‹œë„]
    C -->|No| E[ë¡œê·¸ì¸ í™”ë©´]

    D --> F{í† í° ìœ íš¨?}
    F -->|Yes| G[ìƒˆ Access Token ë°œê¸‰]
    F -->|No| E

    G --> H[ì‚¬ìš©ì ì •ë³´ ë¡œë“œ]
    H --> I[í™ˆ í™”ë©´]

    E --> J[ì†Œì…œ ë¡œê·¸ì¸]
    J --> K[JWT í† í° ë°œê¸‰]
    K --> I
```

### 2.2 ê´€ë¦¬ì ë¡œê·¸ì¸

```mermaid
graph TD
    A[ê´€ë¦¬ì ë¡œê·¸ì¸ í˜ì´ì§€] --> B[ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì…ë ¥]
    B --> C[POST /api/v1/auth/sign/admin]

    C --> D{ì¸ì¦ í™•ì¸}
    D -->|ì„±ê³µ| E[JWT í† í° ë°œê¸‰]
    D -->|ì‹¤íŒ¨| F[ì—ëŸ¬ ë©”ì‹œì§€]

    E --> G[ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ]
    F --> B
```

#### ê´€ë¦¬ì ì¸ì¦ í”„ë¡œì„¸ìŠ¤

```
POST /api/v1/auth/sign/admin
{
  "email": "admin@example.com",
  "password": "secure_password"
}
```

1. User í…Œì´ë¸”ì—ì„œ emailê³¼ role=ADMIN í™•ì¸
2. bcryptë¡œ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ (12 salt rounds)
3. ê³„ì • ì°¨ë‹¨ ìƒíƒœ í™•ì¸
4. JWT í† í° ë°œê¸‰

---

## 3. Travel ìƒì„± ë° ì°¸ì—¬ í”Œë¡œìš°

### 3.1 Travel ì°¸ì—¬ (ì‚¬ìš©ì)

```mermaid
graph TD
    A[ì´ˆëŒ€ ì½”ë“œ ë°›ìŒ] --> B[Travel ì°¸ì—¬ í™”ë©´]
    B --> C[ì´ˆëŒ€ ì½”ë“œ ì…ë ¥]

    C --> D[POST /api/v1/travel-users]
    D --> E{ì´ˆëŒ€ ì½”ë“œ ìœ íš¨?}

    E -->|Yes| F[TravelUser ìƒì„±]
    E -->|No| G[ì—ëŸ¬ ë©”ì‹œì§€]

    F --> H[ìë™ Planet ë©¤ë²„ì‹­ í• ë‹¹]
    H --> I[Travel í™ˆ í™”ë©´]

    I --> J[Planet ëª©ë¡ í™•ì¸]
    J --> K[ì±„íŒ… ì‹œì‘]
```

### 3.2 ìƒì„¸ í”„ë¡œì„¸ìŠ¤

#### Step 1: ì´ˆëŒ€ ì½”ë“œ ê²€ì¦

```
POST /api/v1/travel-users
{
  "inviteCode": "TRAVEL2024"
}
```

#### Step 2: ë©¤ë²„ì‹­ ìƒì„±

1. **Travel ì¡°íšŒ**
   - inviteCodeë¡œ Travel ì°¾ê¸°
   - ìœ íš¨ì„± ë° ë§Œë£Œ í™•ì¸

2. **TravelUser ìƒì„±**
   - role: PARTICIPANT
   - status: ACTIVE
   - joinedAt: í˜„ì¬ ì‹œê°„

3. **Planet ìë™ í• ë‹¹**
   - Travelì˜ ëª¨ë“  GROUP Planetì— ìë™ ê°€ì…
   - PlanetUser ë ˆì½”ë“œ ìƒì„±
   - notificationsEnabled: true (ê¸°ë³¸ê°’)

#### Step 3: Travel ì •ë³´ ë¡œë“œ

```
GET /api/v1/travels/{travelId}?include=travelUsers,planets
```

---

## 4. ì±„íŒ… í”Œë¡œìš°

### 4.1 ë©”ì‹œì§€ ì „ì†¡ í”Œë¡œìš°

```mermaid
graph TD
    A[Planet ì…ì¥] --> B[ë©”ì‹œì§€ ì…ë ¥]
    B --> C{ë©”ì‹œì§€ íƒ€ì…}

    C -->|í…ìŠ¤íŠ¸| D[í…ìŠ¤íŠ¸ ê²€ì¦]
    C -->|ì´ë¯¸ì§€/ë¹„ë””ì˜¤| E[íŒŒì¼ ì—…ë¡œë“œ]
    C -->|íŒŒì¼| E

    D --> F[POST /api/v1/messages]
    E --> G[Presigned URL ìš”ì²­]
    G --> H[íŒŒì¼ ì—…ë¡œë“œ to R2]
    H --> I[ì—…ë¡œë“œ ì™„ë£Œ í™•ì¸]
    I --> F

    F --> J{ê¶Œí•œ í™•ì¸}
    J -->|í—ˆìš©| K[ë©”ì‹œì§€ ì €ì¥]
    J -->|ê±°ë¶€| L[ì—ëŸ¬ ë©”ì‹œì§€]

    K --> M[WebSocket ë¸Œë¡œë“œìºìŠ¤íŠ¸]
    M --> N[í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡]
    N --> O[ì½ìŒ ìƒíƒœ ì¶”ì ]
```

### 4.2 ë©”ì‹œì§€ ìˆ˜ì‹  í”Œë¡œìš°

```mermaid
graph TD
    A[WebSocket ì—°ê²°] --> B[ë©”ì‹œì§€ ìˆ˜ì‹ ]
    B --> C[í™”ë©´ì— í‘œì‹œ]

    C --> D{í˜„ì¬ í™”ë©´?}
    D -->|ì±„íŒ…ë°© ë‚´| E[ìë™ ì½ìŒ ì²˜ë¦¬]
    D -->|ë‹¤ë¥¸ í™”ë©´| F[ì•Œë¦¼ í‘œì‹œ]

    E --> G[POST /api/v1/read-receipts/mark-read]
    F --> H[ì•Œë¦¼ ì¹´ìš´íŠ¸ ì¦ê°€]

    G --> I[ì½ìŒ ìƒíƒœ ë¸Œë¡œë“œìºìŠ¤íŠ¸]
    I --> J[ë°œì‹ ìì—ê²Œ ì½ìŒ í‘œì‹œ]
```

### 4.3 ìƒì„¸ ë‹¨ê³„

#### í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡

```
POST /api/v1/messages
{
  "type": "TEXT",
  "planetId": 123,
  "content": "ì•ˆë…•í•˜ì„¸ìš”!",
  "replyToMessageId": null
}
```

#### ì´ë¯¸ì§€ ë©”ì‹œì§€ ì „ì†¡

```
Step 1: Presigned URL íšë“
POST /api/v1/file-uploads/presigned-url
{
  "fileName": "photo.jpg",
  "fileSize": 2048000,
  "mimeType": "image/jpeg",
  "folder": "messages"
}

Step 2: íŒŒì¼ ì—…ë¡œë“œ (Client â†’ Cloudflare R2)
PUT {presignedUrl}
Body: Binary Image Data

Step 3: ì—…ë¡œë“œ ì™„ë£Œ í™•ì¸
POST /api/v1/file-uploads/complete
{
  "uploadId": 456,
  "storageKey": "messages/2024/photo.jpg"
}

Step 4: ë©”ì‹œì§€ ìƒì„±
POST /api/v1/messages
{
  "type": "IMAGE",
  "planetId": 123,
  "content": "",
  "fileMetadata": {
    "uploadId": 456,
    "url": "https://cdn.example.com/messages/2024/photo.jpg",
    "size": 2048000,
    "mimeType": "image/jpeg"
  }
}
```

---

## 5. íŒŒì¼ ê³µìœ  í”Œë¡œìš°

### 5.1 ëŒ€ìš©ëŸ‰ íŒŒì¼ ì—…ë¡œë“œ (ì²­í¬ ì—…ë¡œë“œ)

```mermaid
graph TD
    A[íŒŒì¼ ì„ íƒ] --> B[íŒŒì¼ í¬ê¸° í™•ì¸]
    B --> C{5MB ì´ìƒ?}

    C -->|Yes| D[íŒŒì¼ ì²­í¬ ë¶„í• ]
    C -->|No| E[ë‹¨ì¼ ì—…ë¡œë“œ]

    D --> F[ì²­í¬ë³„ Presigned URL]
    F --> G[ë³‘ë ¬ ì²­í¬ ì—…ë¡œë“œ]
    G --> H[ì—…ë¡œë“œ ì§„í–‰ë¥  í‘œì‹œ]

    E --> I[Presigned URL ìš”ì²­]
    I --> J[íŒŒì¼ ì—…ë¡œë“œ]

    H --> K[ëª¨ë“  ì²­í¬ ì™„ë£Œ?]
    K -->|Yes| L[íŒŒì¼ ë³‘í•© ìš”ì²­]
    K -->|No| G

    J --> M[ì—…ë¡œë“œ ì™„ë£Œ í™•ì¸]
    L --> M

    M --> N[ë©”ì‹œì§€ì— ì²¨ë¶€]
    N --> O[ì „ì†¡]
```

### 5.2 ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë°

```mermaid
graph TD
    A[ë¹„ë””ì˜¤ ë©”ì‹œì§€ í´ë¦­] --> B[ìŠ¤íŠ¸ë¦¬ë° URL ìš”ì²­]
    B --> C[GET /api/v1/file-uploads/{id}/stream]

    C --> D[CDN URL ë°˜í™˜]
    D --> E[ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ ì´ˆê¸°í™”]

    E --> F[HTTP Range ìš”ì²­]
    F --> G[ì²­í¬ ë‹¨ìœ„ ìŠ¤íŠ¸ë¦¬ë°]

    G --> H{ë²„í¼ë§ í•„ìš”?}
    H -->|Yes| I[ë‹¤ìŒ ì²­í¬ ìš”ì²­]
    H -->|No| J[ì¬ìƒ ê³„ì†]

    I --> G
    J --> K[ì¬ìƒ ì™„ë£Œ]
```

---

## 6. ì•Œë¦¼ ê´€ë¦¬ í”Œë¡œìš°

### 6.1 í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹  í”Œë¡œìš°

```mermaid
graph TD
    A[ìƒˆ ë©”ì‹œì§€ ë°œìƒ] --> B{ì‚¬ìš©ì ìƒíƒœ}

    B -->|ì˜¨ë¼ì¸ & ì±„íŒ…ë°© ë‚´| C[ì½ìŒ ì²˜ë¦¬ë§Œ]
    B -->|ì˜¨ë¼ì¸ & ë‹¤ë¥¸ í™”ë©´| D[ì¸ì•± ì•Œë¦¼]
    B -->|ì˜¤í”„ë¼ì¸| E[í‘¸ì‹œ ì•Œë¦¼]

    D --> F[ì•Œë¦¼ ì„¼í„° ì—…ë°ì´íŠ¸]
    E --> G[FCM/APNS ì „ì†¡]

    G --> H{ì•Œë¦¼ ì„¤ì •}
    H -->|í—ˆìš©| I[ë””ë°”ì´ìŠ¤ ì•Œë¦¼]
    H -->|ê±°ë¶€| J[ë¬´ì‹œ]

    I --> K[ì•Œë¦¼ íƒ­ ì²˜ë¦¬]
    K --> L{ì•Œë¦¼ í´ë¦­?}
    L -->|Yes| M[í•´ë‹¹ ì±„íŒ…ë°© ì´ë™]
    L -->|No| N[ë°°ì§€ ì¹´ìš´íŠ¸ë§Œ í‘œì‹œ]
```

### 6.2 ì•Œë¦¼ ì„¤ì • ê´€ë¦¬

```mermaid
graph TD
    A[ì„¤ì • í™”ë©´] --> B{ì„¤ì • ì¢…ë¥˜}

    B -->|ì „ì²´ ì•Œë¦¼| C[User.notificationsEnabled]
    B -->|Planetë³„ ì•Œë¦¼| D[PlanetUser.notificationsEnabled]
    B -->|í‘¸ì‹œ í† í°| E[í‘¸ì‹œ í† í° ê´€ë¦¬]

    C --> F[PATCH /api/v1/users/{id}]
    D --> G[PATCH /api/v1/planet-users/{id}]
    E --> H{ë™ì‘}

    H -->|ë“±ë¡| I[POST /api/v1/notifications/push-token]
    H -->|í•´ì œ| J[POST /api/v1/notifications/push-token/unregister]
    H -->|ì¡°íšŒ| K[GET /api/v1/notifications/push-tokens]
```

---

## 7. í”„ë¡œí•„ ê´€ë¦¬ í”Œë¡œìš°

### 7.1 í”„ë¡œí•„ ìˆ˜ì •

```mermaid
graph TD
    A[í”„ë¡œí•„ í™”ë©´] --> B[í¸ì§‘ ëª¨ë“œ]
    B --> C[ì •ë³´ ì…ë ¥]

    C --> D{ì…ë ¥ í•„ë“œ}
    D -->|ë‹‰ë„¤ì„| E[ì¤‘ë³µ í™•ì¸]
    D -->|ë‚˜ì´| F[ìœ íš¨ì„± ê²€ì¦]
    D -->|ì„±ë³„| G[ì„ íƒ]
    D -->|ì§ì—…| H[ììœ  ì…ë ¥]

    E --> I{ì‚¬ìš© ê°€ëŠ¥?}
    I -->|Yes| J[ì €ì¥ ê°€ëŠ¥]
    I -->|No| K[ë‹¤ë¥¸ ë‹‰ë„¤ì„]

    F --> J
    G --> J
    H --> J
    K --> C

    J --> L[PATCH /api/v1/profiles/{id}]
    L --> M[í”„ë¡œí•„ ì—…ë°ì´íŠ¸]
    M --> N[ì„±ê³µ ë©”ì‹œì§€]
```

### 7.2 í”„ë¡œí•„ ì¡°íšŒ

```
GET /api/v1/profiles/{userId}?include=user
```

ì‘ë‹µ:

```json
{
  "data": {
    "id": 1,
    "userId": 123,
    "nickname": "ì—¬í–‰ì",
    "name": "í™ê¸¸ë™",
    "gender": "MALE",
    "age": 25,
    "occupation": "ê°œë°œì",
    "user": {
      "id": 123,
      "name": "í™ê¸¸ë™",
      "email": "user@example.com"
    }
  }
}
```

---

## 8. ì‚¬ìš©ì ì°¨ë‹¨/ì‹ ê³  í”Œë¡œìš°

### 8.1 Travel ë ˆë²¨ ì°¨ë‹¨ (HOST ê¶Œí•œ)

```mermaid
graph TD
    A[Travel ë©¤ë²„ ëª©ë¡] --> B[ì‚¬ìš©ì ì„ íƒ]
    B --> C[ì°¨ë‹¨ ì˜µì…˜]

    C --> D[ì°¨ë‹¨ ì‚¬ìœ  ì…ë ¥]
    D --> E[PATCH /api/v1/travel-users/{id}]

    E --> F[status: BANNED ì„¤ì •]
    F --> G[ëª¨ë“  Planetì—ì„œ ìë™ ì œê±°]

    G --> H[ì°¨ë‹¨ ì•Œë¦¼ ë°œì†¡]
    H --> I{ì•Œë¦¼ íƒ€ì…}

    I -->|í‘¸ì‹œ| J[FCM/APNS]
    I -->|ì¸ì•±| K[Notification ìƒì„±]

    J --> L[ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼]
    K --> L
```

### 8.2 Planet ë ˆë²¨ ë®¤íŠ¸ (MUTE ê¸°ëŠ¥)

```mermaid
graph TD
    A[ì±„íŒ…ë°© ë‚´ ì‚¬ìš©ì] --> B[ì‚¬ìš©ì í”„ë¡œí•„ í´ë¦­]
    B --> C[ë®¤íŠ¸ ì˜µì…˜]

    C --> D[PATCH /api/v1/planet-users/{id}]
    D --> E[status: MUTED ì„¤ì •]

    E --> F{ë®¤íŠ¸ íš¨ê³¼}
    F -->|ë©”ì‹œì§€| G[ë©”ì‹œì§€ ì „ì†¡ ë¶ˆê°€]
    F -->|ì•Œë¦¼| H[ì•Œë¦¼ ìˆ˜ì‹  ì•ˆí•¨]
    F -->|í‘œì‹œ| I[ë®¤íŠ¸ ì•„ì´ì½˜ í‘œì‹œ]

    G --> J[ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ]
```

### 8.3 ì‹œìŠ¤í…œ ë ˆë²¨ ì°¨ë‹¨ (ADMIN ê¶Œí•œ)

```mermaid
graph TD
    A[ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ] --> B[ì‚¬ìš©ì ê´€ë¦¬]
    B --> C[ì°¨ë‹¨í•  ì‚¬ìš©ì ì„ íƒ]

    C --> D[ì°¨ë‹¨ ì‚¬ìœ  ì„ íƒ]
    D --> E{ì°¨ë‹¨ ìœ í˜•}

    E -->|ì„ì‹œ| F[ì°¨ë‹¨ ê¸°ê°„ ì„¤ì •]
    E -->|ì˜êµ¬| G[ì˜êµ¬ ì°¨ë‹¨]

    F --> H[User.isBanned = true]
    G --> H

    H --> I[User.bannedAt = now]
    I --> J[User.bannedReason ì €ì¥]

    J --> K[ëª¨ë“  ì„¸ì…˜ ì¢…ë£Œ]
    K --> L[ë¡œê·¸ì¸ ì°¨ë‹¨]
```

---

## 9. ì‹¤ì‹œê°„ ìƒíƒœ ê´€ë¦¬ í”Œë¡œìš°

### 9.1 ì˜¨ë¼ì¸ ìƒíƒœ ì¶”ì 

```mermaid
graph TD
    A[WebSocket ì—°ê²°] --> B[ì‚¬ìš©ì ì¸ì¦]
    B --> C[ì˜¨ë¼ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸]

    C --> D[Redis ì €ì¥]
    D --> E[ìƒíƒœ ë¸Œë¡œë“œìºìŠ¤íŠ¸]

    E --> F{êµ¬ë…ìë“¤ì—ê²Œ ì „íŒŒ}
    F -->|ê°™ì€ Planet| G[ì˜¨ë¼ì¸ í‘œì‹œ]
    F -->|ì¹œêµ¬ ëª©ë¡| H[ì˜¨ë¼ì¸ í‘œì‹œ]

    I[WebSocket ì¢…ë£Œ] --> J[ì˜¤í”„ë¼ì¸ ìƒíƒœ]
    J --> K[Redis ì‚­ì œ]
    K --> L[ìƒíƒœ ë¸Œë¡œë“œìºìŠ¤íŠ¸]
```

### 9.2 íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°

```mermaid
graph TD
    A[í…ìŠ¤íŠ¸ ì…ë ¥ ì‹œì‘] --> B[íƒ€ì´í•‘ ì´ë²¤íŠ¸]
    B --> C[WebSocket ì „ì†¡]

    C --> D[ì„œë²„ ë¸Œë¡œë“œìºìŠ¤íŠ¸]
    D --> E[ê°™ì€ Planet ì‚¬ìš©ì]

    E --> F[íƒ€ì´í•‘ í‘œì‹œ]
    F --> G[3ì´ˆ íƒ€ì´ë¨¸]

    G --> H{ê³„ì† íƒ€ì´í•‘?}
    H -->|Yes| G
    H -->|No| I[íƒ€ì´í•‘ í‘œì‹œ ì œê±°]
```

---

## 10. ì—ëŸ¬ ì²˜ë¦¬ í”Œë¡œìš°

### 10.1 API ì—ëŸ¬ ì²˜ë¦¬

```mermaid
graph TD
    A[API ìš”ì²­] --> B{ì‘ë‹µ ìƒíƒœ}

    B -->|200-299| C[ì„±ê³µ ì²˜ë¦¬]
    B -->|401| D[í† í° ê°±ì‹  ì‹œë„]
    B -->|403| E[ê¶Œí•œ ì—†ìŒ ì•Œë¦¼]
    B -->|404| F[ë¦¬ì†ŒìŠ¤ ì—†ìŒ]
    B -->|500+| G[ì„œë²„ ì—ëŸ¬]

    D --> H{ê°±ì‹  ì„±ê³µ?}
    H -->|Yes| I[ìš”ì²­ ì¬ì‹œë„]
    H -->|No| J[ë¡œê·¸ì¸ í™”ë©´]

    E --> K[ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ]
    F --> K
    G --> L[ì¬ì‹œë„ or ì§€ì›íŒ€ ì•ˆë‚´]
```

### 10.2 ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì²˜ë¦¬

```mermaid
graph TD
    A[ë„¤íŠ¸ì›Œí¬ ìš”ì²­] --> B{ì—°ê²° ìƒíƒœ}

    B -->|ì—°ê²°ë¨| C[ì •ìƒ ì²˜ë¦¬]
    B -->|ì—°ê²° ëŠê¹€| D[ì˜¤í”„ë¼ì¸ ëª¨ë“œ]

    D --> E[ë¡œì»¬ ìºì‹œ ì‚¬ìš©]
    E --> F[íì— ìš”ì²­ ì €ì¥]

    G[ì—°ê²° ë³µêµ¬] --> H[í ì²˜ë¦¬]
    H --> I[ë™ê¸°í™”]
    I --> J[ìµœì‹  ìƒíƒœ ë°˜ì˜]
```

---

## 11. ì„±ëŠ¥ ìµœì í™” í”Œë¡œìš°

### 11.1 ë©”ì‹œì§€ í˜ì´ì§€ë„¤ì´ì…˜

```mermaid
graph TD
    A[ì±„íŒ…ë°© ì…ì¥] --> B[ìµœê·¼ 50ê°œ ë©”ì‹œì§€ ë¡œë“œ]
    B --> C[í™”ë©´ í‘œì‹œ]

    D[ìŠ¤í¬ë¡¤ ìœ„ë¡œ] --> E{ë” ë¡œë“œ?}
    E -->|Yes| F[ì´ì „ 50ê°œ ìš”ì²­]
    E -->|No| G[ëŒ€ê¸°]

    F --> H[ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§€ë„¤ì´ì…˜]
    H --> I[ë©”ì‹œì§€ ì¶”ê°€]
    I --> J[ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ìœ ì§€]
```

### 11.2 ì´ë¯¸ì§€ ìµœì í™”

```mermaid
graph TD
    A[ì´ë¯¸ì§€ ì—…ë¡œë“œ] --> B{íŒŒì¼ í¬ê¸°}

    B -->|<5MB| C[ì›ë³¸ ì—…ë¡œë“œ]
    B -->|>=5MB| D[ìë™ ë¦¬ì‚¬ì´ì§•]

    D --> E[ìµœëŒ€ 1920x1080]
    E --> F[WebP ë³€í™˜]
    F --> G[í’ˆì§ˆ 85%]

    C --> H[CDN ì—…ë¡œë“œ]
    G --> H

    H --> I[ì¸ë„¤ì¼ ìƒì„±]
    I --> J[ë‹¤ì–‘í•œ í¬ê¸° ë²„ì „]
    J --> K[ë””ë°”ì´ìŠ¤ë³„ ìµœì í™”]
```

---

## 12. ë³´ì•ˆ í”Œë¡œìš°

### 12.1 JWT í† í° ê´€ë¦¬

```mermaid
graph TD
    A[ë¡œê·¸ì¸ ì„±ê³µ] --> B[í† í° ë°œê¸‰]
    B --> C{í† í° ì¢…ë¥˜}

    C -->|Access Token| D[ë©”ëª¨ë¦¬ ì €ì¥]
    C -->|Refresh Token| E[Secure Storage]

    D --> F[15ë¶„ ìœ íš¨]
    E --> G[7ì¼ ìœ íš¨]

    F --> H{ë§Œë£Œ?}
    H -->|Yes| I[Refresh ìš”ì²­]
    H -->|No| J[API ìš”ì²­]

    I --> K[ìƒˆ Access Token]
    K --> J
```

### 12.2 ë°ì´í„° ì•”í˜¸í™”

```mermaid
graph TD
    A[ë¯¼ê°í•œ ë°ì´í„°] --> B{ë°ì´í„° ìœ í˜•}

    B -->|ë¹„ë°€ë²ˆí˜¸| C[bcrypt í•´ì‹±]
    B -->|ê°œì¸ì •ë³´| D[AES ì•”í˜¸í™”]
    B -->|í† í°| E[JWT ì„œëª…]

    C --> F[Salt rounds: 12]
    D --> G[256-bit í‚¤]
    E --> H[RS256 ì•Œê³ ë¦¬ì¦˜]

    F --> I[DB ì €ì¥]
    G --> I
    H --> J[ì „ì†¡]
```

---

## ğŸ“ í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨ ë²”ë¡€

- **ì‚¬ê°í˜•**: í”„ë¡œì„¸ìŠ¤ ë˜ëŠ” ì•¡ì…˜
- **ë‹¤ì´ì•„ëª¬ë“œ**: ê²°ì • í¬ì¸íŠ¸
- **ì›**: ì‹œì‘/ì¢…ë£Œ í¬ì¸íŠ¸
- **í™”ì‚´í‘œ**: í”Œë¡œìš° ë°©í–¥
- **ì ì„ **: ì„ íƒì  ê²½ë¡œ
- **ì‹¤ì„ **: í•„ìˆ˜ ê²½ë¡œ

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [API Routes Documentation](./routes.md)
- [Database Schema](./schema.md)
- [WebSocket Events](./websocket.md)
- [Error Codes](./errors.md)
