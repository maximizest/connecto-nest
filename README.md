# Connecto-nest API

NestJS 11.x 기반 백엔드 API 서버로, 여행 그룹 채팅 플랫폼을 위한 실시간 메시징 및 협업 기능을 제공합니다.

## 🎯 프로젝트 개요

- **프레임워크**: NestJS 11.x + TypeScript 5.7.x
- **데이터베이스**: PostgreSQL + TypeORM
- **인증**: JWT + 소셜 로그인 (Google, Apple, Kakao, Naver)
- **실시간 통신**: WebSocket (Socket.io)
- **CRUD**: @foryourdev/nestjs-crud 자동 생성
- **패키지 매니저**: yarn

## 📁 모듈 구조 (@modules/)

### 🔐 인증 및 사용자 관리

#### **admin**

- **역할**: 시스템 관리자 계정 및 권한 관리
- **주요 기능**:
  - 관리자 계정 생성/수정/삭제
  - 관리자 권한 레벨 관리
  - 시스템 관리 기능 접근 제어

#### **user**

- **역할**: 일반 사용자 계정 및 프로필 관리
- **주요 기능**:
  - 사용자 회원가입/로그인/탈퇴
  - 소셜 로그인 연동 (Google, Apple, Kakao, Naver)
  - 사용자 인증 토큰 관리
  - 계정 삭제 영향도 분석 및 처리

#### **profile**

- **역할**: 사용자 개인 프로필 정보 관리
- **주요 기능**:
  - 프로필 사진, 닉네임, 상태 메시지 관리
  - 개인 설정 및 선호도 저장
  - 프로필 공개/비공개 설정

### 🌍 여행 및 그룹 관리

#### **travel**

- **역할**: 여행 그룹 생성 및 관리
- **주요 기능**:
  - 여행 그룹 생성/수정/삭제
  - 여행 일정 및 만료 시간 관리
  - 여행 그룹 공개/비공개 설정
  - 여행 그룹 만료 시 자동 비활성화

#### **travel-user**

- **역할**: 여행 그룹 멤버십 관리
- **주요 기능**:
  - 여행 그룹 초대/참여/탈퇴
  - 멤버 권한 관리 (호스트/일반 멤버)
  - 멤버 상태 추적 및 관리

#### **planet**

- **역할**: 채팅방(Planet) 생성 및 관리
- **주요 기능**:
  - 단체 채팅방 및 1:1 채팅방 생성
  - 채팅방 접근 권한 제어
  - 시간 제한 채팅방 기능
  - 직접 접근 채팅방 관리

#### **planet-user**

- **역할**: 채팅방 멤버십 관리
- **주요 기능**:
  - 채팅방 참여/탈퇴 관리
  - 멤버 권한 및 역할 설정
  - 채팅방 내 사용자 상태 관리

### 💬 메시징 및 커뮤니케이션

#### **message**

- **역할**: 채팅 메시지 송수신 및 관리
- **주요 기능**:
  - 텍스트, 이미지, 비디오, 파일 메시지 처리
  - 메시지 편집/삭제 (소프트 삭제)
  - 메시지 히스토리 및 검색
  - 대용량 파일(500MB) 지원

#### **read-receipt**

- **역할**: 메시지 읽음 상태 관리
- **주요 기능**:
  - 메시지 읽음/안읽음 상태 추적
  - 읽음 통계 및 분석
  - 배치 읽음 처리
  - 실시간 읽음 상태 업데이트

#### **websocket**

- **역할**: 실시간 통신 및 WebSocket 관리
- **주요 기능**:
  - 실시간 메시지 전송
  - 타이핑 인디케이터
  - 온라인 상태 관리
  - WebSocket 연결 관리 및 인증

#### **notification**

- **역할**: 푸시 알림 및 시스템 알림 관리
- **주요 기능**:
  - FCM 푸시 알림 전송
  - 알림 설정 및 선호도 관리
  - 알림 통계 및 분석
  - 푸시 토큰 관리

### 📁 파일 및 미디어 관리

#### **file-upload**

- **역할**: 파일 업로드 및 스토리지 관리
- **주요 기능**:
  - 멀티파트 청크 업로드 (5MB 단위)
  - Cloudflare R2 스토리지 연동
  - 파일 타입 검증 및 스캔
  - 업로드 진행률 추적

#### **streaming**

- **역할**: 미디어 스트리밍 서비스
- **주요 기능**:
  - 비디오/오디오 스트리밍
  - HLS (HTTP Live Streaming) 지원
  - 썸네일 자동 생성
  - CDN 최적화 스트리밍

#### **video-processing**

- **역할**: 비디오 처리 및 변환
- **주요 기능**:
  - 비디오 인코딩/디코딩
  - 해상도 변환 및 최적화
  - 썸네일 생성
  - 비디오 메타데이터 추출

### 🗄️ 캐시 및 성능 관리

#### **cache**

- **역할**: Redis 기반 캐싱 시스템
- **주요 기능**:
  - 온라인 사용자 상태 캐싱
  - API 응답 캐싱
  - 세션 데이터 관리
  - 캐시 무효화 및 이벤트 관리

#### **performance**

- **역할**: 시스템 성능 모니터링
- **주요 기능**:
  - API 응답 시간 추적
  - 시스템 리소스 모니터링
  - 성능 메트릭 수집
  - 성능 최적화 제안

#### **analytics**

- **역할**: 사용자 행동 및 시스템 분석
- **주요 기능**:
  - 사용자 활동 통계
  - 메시지 및 채팅방 사용 분석
  - 실시간 분석 데이터 제공
  - 사용자 인사이트 생성

### 🔒 보안 및 시스템 관리

#### **security**

- **역할**: 보안 정책 및 접근 제어
- **주요 기능**:
  - 파일 보안 스캔
  - 악성코드 탐지
  - API 레이트 리미팅
  - 보안 로그 및 감사

#### **scheduler**

- **역할**: 배경 작업 및 스케줄링
- **주요 기능**:
  - 여행 만료 스케줄링
  - 데이터 정리 작업
  - 시스템 최적화 작업
  - 스케줄러 상태 모니터링

#### **schema**

- **역할**: 데이터베이스 스키마 정보 제공
- **주요 기능**:
  - 엔티티 메타데이터 조회
  - CRUD 설정 정보 제공
  - 보안 유효성 검증
  - 개발 전용 스키마 API

### 💾 스토리지 및 유틸리티

#### **storage**

- **역할**: 파일 저장소 관리
- **주요 기능**:
  - 로컬 파일 시스템 관리
  - 클라우드 스토리지 연동
  - 파일 백업 및 복원
  - 스토리지 용량 관리

## 🏗️ 아키텍처 특징

### **Entity-First CRUD 패턴**

- 모든 컨트롤러는 해당 모듈의 엔티티만 반환
- `@foryourdev/nestjs-crud` 활용한 표준화된 API
- `allowedIncludes`를 통한 관계 데이터 포함

### **Travel-Planet 구조**

- **Travel**: 여행 그룹 (상위 컨테이너)
- **Planet**: 실제 채팅방 (단체/1:1)
- 계층적 권한 관리 및 만료 정책

### **실시간 통신**

- WebSocket 기반 실시간 메시징
- 타이핑 인디케이터 및 온라인 상태
- 읽음 상태 실시간 동기화

### **대용량 파일 처리**

- 500MB 파일 업로드 지원
- 청크 기반 업로드 (5MB 단위)
- Cloudflare R2 스토리지 활용

## 🚀 시작하기

```bash
# 의존성 설치
yarn install

# 데이터베이스 마이그레이션
yarn migration:run

# 개발 서버 시작
yarn dev
```

## 📝 API 문서

- **Base URL**: `/api/v1`
- **인증**: JWT Bearer Token
- **자동 문서**: `@foryourdev/jest-swag` 기반

## 🔧 환경 설정

주요 환경변수:

- `DATABASE_URL`: PostgreSQL 연결 URL
- `JWT_SECRET`: JWT 서명 키 (32자 이상)
- `REDIS_URL`: Redis 연결 URL
- `CLOUDFLARE_R2_*`: R2 스토리지 설정

## 📋 개발 가이드라인

- **Import 경로**: 반드시 상대경로 사용 (`../../module`)
- **패키지 매니저**: yarn만 사용 (npm 금지)
- **CRUD 패턴**: `CrudService` 상속 및 `@Crud` 데코레이터 활용
- **보안**: `allowedFilters`, `allowedParams`, `allowedIncludes` 필수 설정
- **테스트**: Jest E2E 테스트 및 `describeE2E` 활용

이 문서는 Connecto-nest 프로젝트의 모듈 구조와 각 모듈의 역할을 설명합니다. 각 모듈은 독립적이면서도 유기적으로 연결되어 완전한 여행 그룹 채팅 플랫폼을 구성합니다.
